<html>
  <head>
    <meta charset="utf-8">
    <style>
      #clients {
        position: absolute;
        left: 0px;
        top: 0px;
        width: 20%;
        height: 49%;
        word-wrap: break-word;
        font-size: 15px;
        margin: 0 0;
        border: 2px solid black;
      }
      #blocks_queue {
        position: absolute;
        top: 49%;
        left: 0px;
        border: 2px solid black;
        text-size: 15px;
        word-wrap: break-word;
        width: 20%;
        height: 50%;
      }
      #message_block {
        position: absolute;
        left: 20%;
        width: 59%;
        height: 99%;
        top: 0px;
        border: 2px solid black;
        overflow: scroll;
      }
      #clients-inner {
        margin: 10px;
      }
      #blocks-queue-inner {
        margin: 10px;
      }
      #inner-message-div {
        margin: 10px;
      }
      .message {
        width: 95%;
        margin: 15px;
        min-height: 100px;
        border: 1px solid black;
        padding: 5px;
        word-wrap: break-word;
      }
      #field-block {
        position: absolute;
        left: 79%;
        width: 20%;
        border: 1px solid black;
        top: 0px;
        height: 99%;
      }
      #inner-field-block {
        margin: 10px;
      }
      #area {
        resize: none;
        width: 100%;
        font-size: 15px;
      }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  </head>
  <body>
    <div id="clients"><div id="clients-inner"></div>
  <button style="position: absolute; bottom: 10px; left: 10px" id="sessions">Start sessions</button>
<button style="position: absolute; bottom: 10px; left: 170px" id="exchange">Start exchange</button></div>
    <div id="blocks_queue"><div id="blocks-queue-inner"></div></div>
    <div id="message_block"><div id="inner-message-block"><div class="message">Hello</div><div class="message">Hello</div></div></div>
    <div id="field-block"><div id="inner-field-block">
      <textarea id="area" rows="20"></textarea>
      <button id="send-msg" style="width: 100%;margin-top: 10px;">Send</button>
    </div></div>
    <script>
      function updateComms() {
        $.get("/comms", function(data){
          var clients = document.getElementById("clients-inner")
          clients.innerHTML = ""
          var obj = JSON.parse(data);
          for (var k in obj) {
            clients.innerHTML += "<font style='font-size: 18px'>" + k + "</font><br>";
            for (var j in obj[k].Clients) {
              clients.innerHTML += "<font id='" + obj[k].Clients[j] + "'>&nbsp;&nbsp;&nbsp;&nbsp" + obj[k].Clients[j] + "</font><br><br>";
              $.get("/asession?client=" + obj[k].Clients[j], function(dat) {
                if (dat.split(";")[0] == "true")
                  clients.innerHTML = clients.innerHTML.split(dat.split(";")[1]).join(dat.split(";")[1] + " [SESSION]");
              });

            }
          }
        });
      }
      updateComms();
      setInterval(updateComms, 5000);
      function updateTasks() {
        $.get("/tasks", function(data){
          var tasks = document.getElementById("blocks-queue-inner")
          tasks.innerHTML = ""
          var obj = JSON.parse(data);
          for (var k in obj) {
            tasks.innerHTML += "<font>Block:&nbsp;" + atob(obj[k].Data) + "</font><br><br>"
          }
        });
      }
      function updateBlocks() {
        $.get("/blocks", function(data){
          var messages = document.getElementById("inner-message-block");
          messages.innerHTML = "";
          var obj = JSON.parse(data);
          var key_s = [];
          for (var k in obj) {
            key_s.push(k);
          }
          key_s.sort();
          console.log(key_s);
          for (var k in key_s) {
            for (var j in obj[key_s[k]]) {
              messages.innerHTML += "<div class='message'>" + obj[key_s[k]][j] + "</div>";
            }
          }
        });
      }
      $("#sessions").click(function() {
        $.get("/sessions", function(data) {});
      });
      $("#exchange").click(function() {
        $.get("/exchange", function(data) {});
      });
      $("#send-msg").click(function() {
        var msg = document.getElementById("area").value;
        $.get("/send-msg?msg=" + msg, function(data) {});
      });
      updateTasks();
      updateBlocks();
      setInterval(updateTasks, 2000);
      setInterval(updateBlocks, 5000);
    </script>
  </body>
</html>
